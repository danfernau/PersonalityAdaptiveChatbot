<!DOCTYPE html>
<head>
	<link rel="icon" href="https://img.icons8.com/fluency/48/000000/bot.png" type="image/x-icon">  
    <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
</head>
<body>
  <h1 class="header" style="padding-top:4%;font-style: bold; color:white; font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; text-align:center;">Welcome to your Job Recommendation Bot!</h1>
  <div style="height: 80%; margin-top:5%; margin-left:30%; margin-bottom: 3%;" id="webchat" role="main"></div>
  <!-- <p style="color: white; text-align:center"><b>NOTE: It could take about 1 minute until the bot greets you the first time. If that is not the case, please refresh the page..</b></p> -->
  <p class="bottom" style="color: white">Photo by Mitchell Luo on Unsplash</p>
  <script>

	 //get URL parameters:
	 var url = window.location.href
	 var getParams = url.split("?")
	 var splitParams = getParams[1].split("&")


	 var userID = splitParams[0].split('=')[1]
	 var userPers = splitParams[1].split('=')[1]

	 // get only last two digits
	 var splitPers = userPers.split('')
	 var valsEI = splitPers[splitPers.length-2]+splitPers[splitPers.length-1]
	 valsEI = parseInt(valsEI)

	 console.log(splitParams)
	 console.log('UserID: ' + userID)
	 

	 var persEI = '0';
	 var parsTF = '0';

	 if(splitPers.length == 4){
    valsEI = splitPers[splitPers.length-2]+splitPers[splitPers.length-1]
    valsTF = splitPers[splitPers.length-4]+splitPers[splitPers.length-3]
    } else if (splitPers.length == 3) {
				valsEI = splitPers[splitPers.length-2]+splitPers[splitPers.length-1]
				valsTF = splitPers[splitPers.length-3];
		} else {
				valsEI = '0';
				valsTF = '0';
		}
		console.log('EI: ' + valsEI)
		console.log('TF: ' + valsTF)

		valsEI = parseInt(valsEI)
		valsTF = parseInt(valsTF)


	 if(valsEI > 17) {
		 document.getElementsByClassName("header")[0].innerText = "Welcome to Carla your Job Recommendation Bot!";
		 userPers = 'E';
	 } else {
		 document.getElementsByClassName("header")[0].innerText = "Welcome to Sophia your Job Recommendation Bot!";
		 userPers = 'I';
	 }

	 	 if(valsTF > 17) {
		 userPers = userPers + 'F';
	 } else {
		 userPers = userPers + 'T';
	 }



	var userPersInv = ""
	 switch(userPers) {

		 case 'EF':
		 userPersInv = "IT"
		 break;
		 
		 case 'ET':
		 userPersInv = "IF"
		 break;
		 
		 case 'IF':
		 userPersInv = "ET"
		 break;
		 	
		 case 'IT':
		 userPersInv = "EF"	
		 break;

		 default:
		 userPersInv = userPers;

	 }
	var isSecondLink = getParams[0].includes("second");

	if(isSecondLink) {
		var userParams = userID + '!' + userPersInv + '!' + isSecondLink.toString() + '!' + splitParams[1].split('=')[1];
	} else {
		var userParams = userID + '!' + userPers + '!' + isSecondLink.toString() + '!' + splitParams[1].split('=')[1];
	}

	

	console.log('Pers: ' + userPers)
	console.log('PersInv' + userPersInv)
	console.log('userParams: ' + userParams)

     // Set  the CSS rules.
     const styleSet = window.WebChat.createStyleSet({
         bubbleBackground: 'rgba(255, 255, 255, .9)',
         bubbleFromUserBackground: 'rgba(119,221,119,.6)',
         rootHeight: '450px',
         rootWidth: '60%',
         backgroundColor: 'rgba(217,217,214,.85)',
      });

      // After generated, you can modify the CSS rules.
      // Change font family and weight. 
      styleSet.textContent = {
         ...styleSet.textContent,
         fontFamily: "'Calibri', 'Helvetica Neue', sans-serif",
         fontWeight: 'normal'
      };

          // Set the avatar options. 
     const avatarOptions = {
         botAvatarInitials: 'C',
         userAvatarInitials: 'U',
         hideuploadButton: true,
         emojiSet: true,
         borderRadius: "15px"
         };
	var user = {
                id: 'user-id',
                name: 'user name' }
    window.WebChat.renderWebChat({
      directLine: window.WebChat.createDirectLine({
          token: '1iCKtA0chj4.NXhfeZxgHmnpxHNu2Nw8lTQizMeF19gI4rOhOh2Plvs'}),
      userID: userParams,
      styleSet,
      styleOptions: avatarOptions
    }, document.getElementById('webchat'));
    
  </script>
  <style>
      body {
          background-image: url("https://images.unsplash.com/photo-1577017040065-650ee4d43339?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2070&q=80");
          background-repeat: no-repeat;
          background-position: left;
          background-size: 130% 140%;
      };

      .webchat__send-box__main {
          border-radius: 15px;
      }

	  .bottom {
		position: absolute;
		bottom: 0;
		left: 0;
		}
  </style>
</body> 